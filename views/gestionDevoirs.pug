doctype html
html
  include includes/head.pug
  body
    +navbar("SGA ‚Äì Devoirs du cours", user)

    .container.mt-5
      .text-center.mb-4
        h1.mb-2 Gestion des devoirs
        h4.text-muted Cours : #{group_id}

      // --- Liste des devoirs ---
      if devoirs && devoirs.length
        ul.list-group.mb-4
          each d in devoirs
            li.list-group-item.d-flex.justify-content-between.align-items-center
              // Colonne gauche : infos devoir
              .me-3
                h5.mb-1= d.titre
                if d.description
                  p.mb-1.text-secondary(style="max-width: 60ch;")= d.description
                p.mb-1
                  strong Note maximale :
                  |  #{d.noteMax}
                p.mb-1
                  strong Date de d√©but :
                  |  #{new Date(d.dateDebut).toLocaleDateString('fr-CA')}
                p.mb-1
                  strong Date de fin :
                  |  #{new Date(d.dateFin).toLocaleDateString('fr-CA')}

              // Colonne droite : √©tat + actions
              .d-flex.flex-column.align-items-center(style="min-width:180px;")
                // √âtat du devoir
                small.text-muted.d-flex.align-items-center.justify-content-center.mb-2
                  | √âtat du devoir :
                  if d.etat
                    span.ms-2.badge.bg-success Actif
                  else
                    span.ms-2.badge.bg-secondary Inactif

                // Actions (m√™mes largeurs)
                .d-flex.flex-column.align-items-stretch.w-100.gap-2
                  // Bouton afficher √©tudiants (par devoir)
                  button.btn.btn-outline-primary.btn-sm.btn-show-students.w-100(
                    type="button",
                    data-devtitle=d.titre,
                    data-group=group_id,
                    style="min-width:180px;"
                  ) Afficher √©tudiants
                  
                  // üÜï Bouton supprimer
                  form.m-0(
                    action=`/cours/${group_id}/devoirs/delete`
                    method="post"
                    onsubmit=`return confirm('√ätes-vous s√ªr de vouloir supprimer le devoir "${d.titre}" ?');`
                  )
                    input(type="hidden" name="titre" value=d.titre)
                    button.btn.btn-danger.btn-sm.w-100(
                      type="submit"
                      style="min-width:180px;"
                    ) üóëÔ∏è Supprimer

              // Conteneur liste d'√©tudiants (cach√© par d√©faut)
              .students-list-container(
                data-dev-title=d.titre,
                data-group-id=group_id,
                style="display:none; margin-top:0.5rem;"
              )
      else
        p.text-muted.mb-4 Aucun devoir pour ce cours.

      // ---- Boutons d'action globaux ----
      .d-flex.justify-content-center.gap-3.mt-4
        a.btn.btn-secondary(href="/mesCours") ‚¨ÖÔ∏è Page pr√©c√©dente
        a.btn.btn-primary(href='/cours/' + group_id + '/devoirs/add') ‚ûï Ajouter devoir
        //- a.btn.btn-danger(href=`/cours/${group_id}/devoirs/delete`) üóëÔ∏è Supprimer devoir

// --- Toast de confirmation / erreur ---
if message
  div#toast-message.alert.alert-success(style="position:fixed;bottom:1rem;right:1rem;z-index:1050;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);")
    strong ‚úÖ #{message}
if error
  div#toast-message.alert.alert-danger(style="position:fixed;bottom:1rem;right:1rem;z-index:1050;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);")
    strong ‚ùå #{error}

script.
  setTimeout(() => {
    const el = document.getElementById('toast-message');
    if (el) el.remove();
  }, 4000);

// Script qui g√®re l'affichage des √©tudiants par devoir
script(src='/lib/gestionDevoirs.js')
