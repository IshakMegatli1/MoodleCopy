html
  include includes/head.pug
  body
    +navbar("SGA – Questionnaires du cours", user)

    .container.mt-5
      .text-center.mb-4
        h1.mb-2 Gestion des questionnaires
        h4.text-muted Cours : #{group_id}

      // --- Liste des questionnaires ---
      if questionnaires && questionnaires.length
        ul.list-group.mb-4
          each qn in questionnaires
            li.list-group-item.d-flex.justify-content-between.align-items-start
              .me-3
                strong= qn.nom
                if qn.description
                  div.text-muted.mt-1(style="max-width: 60ch;")= qn.description
                // Compteur de questions
                - const nbQ = (typeof qn.getNombreQuestions === 'function') ? qn.getNombreQuestions() : (qn.questions ? qn.questions.length : 0);
                small.text-muted.mt-1(d="block") #{nbQ} #{nbQ > 1 ? 'questions' : 'question'}
              .text-end
                // État (actif/inactif)
                if qn.actif
                  span.badge.bg-success.me-2 Actif
                else
                  span.badge.bg-secondary.me-2 Inactif
                // Actions: gérer et afficher étudiants (bouton ajouté)
                .d-flex.flex-column.align-items-end
                  a.btn.btn-outline-primary.btn-sm.mb-2(href=`/cours/${group_id}/questionnaires/${encodeURIComponent(qn.nom)}/categories`) Gérer (catégories)
                  // Le bouton affiche la liste des étudiants du questionnaire (mêmes classes CSS que le bouton au-dessus)
                  button.btn.btn-outline-primary.btn-sm.btn-show-students(type='button', data-gnom=qn.nom, data-group=group_id) Afficher étudiants
              // Conteneur où la liste des étudiants sera injectée (initialement caché)
              .students-list-container(data-qn-name=qn.nom, data-group-id=group_id, style='display:none; margin-top:0.5rem;')
      else
        p.text-muted.mb-4 Aucun questionnaire pour ce cours.

      // ---- Boutons d'action globaux ----
      .d-flex.justify-content-center.gap-3.mt-4
        a.btn.btn-secondary(href="/mesCours") ⬅️ Page précédente
        a.btn.btn-primary(href=`/cours/${group_id}/questionnaires/add`) ➕ Créer un questionnaire 

// --- Toast de confirmation / erreur ---
if message
  div#toast-message.alert.alert-success(style="position:fixed;bottom:1rem;right:1rem;z-index:1050;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);")
    strong ✅ #{message}
if error
  div#toast-message.alert.alert-danger(style="position:fixed;bottom:1rem;right:1rem;z-index:1050;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.2);")
    strong ❌ #{error}

script.
  setTimeout(() => {
    const el = document.getElementById('toast-message');
    if (el) el.remove();
  }, 4000);

// Inclure le script qui gère l'affichage des étudiants par questionnaire
script(src='/lib/gestionQuestionnaires.js')
